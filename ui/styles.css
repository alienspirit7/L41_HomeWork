/* ── Design System ─────────────────────────────────── */
@import url('https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700&display=swap');

/* ── Dark Theme (default) ──────────────────────────── */
:root {
    --bg-primary:      #0f0f1a;
    --bg-secondary:    #1a1a2e;
    --bg-card:         #1c1c32;
    --bg-input:        #14142a;
    --border:          rgba(255,255,255,0.09);
    --border-focus:    rgba(99,102,241,0.6);
    --text-primary:    #e4e4f0;
    --text-secondary:  #9ca3b0;
    --text-muted:      #5c6370;
    --accent:          #6366f1;
    --accent-light:    #818cf8;
    --accent-glow:     rgba(99,102,241,0.2);
    --success:         #34d399;
    --success-bg:      rgba(52,211,153,0.1);
    --success-border:  rgba(52,211,153,0.25);
    --warning-text:    #fbbf24;
    --warning-bg:      rgba(251,191,36,0.1);
    --warning-border:  rgba(251,191,36,0.3);
    --danger:          #f87171;
    --danger-bg:       rgba(248,113,113,0.08);
    --danger-border:   rgba(248,113,113,0.3);
    --gradient-1:      linear-gradient(135deg, #6366f1, #8b5cf6);
    --gradient-2:      linear-gradient(135deg, #34d399, #06b6d4);
    --shadow-sm:       0 1px 4px rgba(0,0,0,0.4);
    --shadow-md:       0 4px 16px rgba(0,0,0,0.5);
    --r-sm: 8px;
    --r-md: 12px;
    --r-lg: 16px;
    --t: 0.18s ease;
    /* ambient */
    --glow-a: rgba(99,102,241,0.07);
    --glow-b: rgba(139,92,246,0.05);
}

/* ── Light Theme ────────────────────────────────────── */
[data-theme="light"] {
    --bg-primary:      #f2f2f8;
    --bg-secondary:    #e8e8f2;
    --bg-card:         #ffffff;
    --bg-input:        #f6f6fc;
    --border:          rgba(0,0,0,0.1);
    --border-focus:    rgba(79,82,216,0.55);
    --text-primary:    #111827;
    --text-secondary:  #4b5563;
    --text-muted:      #9ca3af;
    --accent:          #4f52d8;
    --accent-light:    #6366f1;
    --accent-glow:     rgba(99,102,241,0.15);
    --success:         #059669;
    --success-bg:      rgba(5,150,105,0.08);
    --success-border:  rgba(5,150,105,0.25);
    --warning-text:    #92400e;
    --warning-bg:      rgba(251,191,36,0.15);
    --warning-border:  rgba(217,119,6,0.35);
    --danger:          #dc2626;
    --danger-bg:       rgba(220,38,38,0.06);
    --danger-border:   rgba(220,38,38,0.25);
    --shadow-sm:       0 1px 4px rgba(0,0,0,0.07);
    --shadow-md:       0 4px 16px rgba(0,0,0,0.1);
    --glow-a: rgba(99,102,241,0.05);
    --glow-b: rgba(139,92,246,0.03);
}

/* ── Reset ──────────────────────────────────────────── */
*, *::before, *::after { margin:0; padding:0; box-sizing:border-box; }
html { scroll-behavior: smooth; }

body {
    font-family: 'Inter', -apple-system, BlinkMacSystemFont, 'Segoe UI', sans-serif;
    background: var(--bg-primary);
    color: var(--text-primary);
    min-height: 100vh;
    line-height: 1.6;
    -webkit-font-smoothing: antialiased;
    transition: background var(--t), color var(--t);
}

body::before {
    content: '';
    position: fixed;
    inset: 0;
    background:
        radial-gradient(ellipse at 15% 10%, var(--glow-a) 0%, transparent 50%),
        radial-gradient(ellipse at 85% 90%, var(--glow-b) 0%, transparent 50%);
    pointer-events: none;
    z-index: 0;
}

/* ── Layout ─────────────────────────────────────────── */
.container {
    max-width: 820px;
    margin: 0 auto;
    padding: 2rem 1.5rem 4rem;
    position: relative;
    z-index: 1;
}

/* ── Page Header ────────────────────────────────────── */
.page-header {
    display: flex;
    align-items: center;
    justify-content: space-between;
    gap: 1rem;
    margin-bottom: 1.25rem;
}

/* Title row: icon + "Meal Analyser" + badge, all on one baseline */
.title-row {
    display: flex;
    align-items: baseline;
    gap: 0.5rem;
    flex-wrap: nowrap;
}

.title-row h1 {
    font-size: clamp(1.4rem, 3.5vw, 2rem);
    font-weight: 700;
    background: var(--gradient-1);
    -webkit-background-clip: text;
    -webkit-text-fill-color: transparent;
    background-clip: text;
    white-space: nowrap;
    line-height: 1.2;
}

/* Badge sits on the text baseline, no gradient inheritance */
.version-badge {
    font-size: 0.68rem;
    font-weight: 600;
    color: var(--text-muted);
    /* override any gradient leak from parent */
    background: none;
    -webkit-background-clip: unset;
    -webkit-text-fill-color: currentColor;
    background-clip: unset;
    white-space: nowrap;
    line-height: 1;
    /* align to the bottom of the text baseline */
    align-self: flex-end;
    padding-bottom: 0.1em;
}

.header-sub {
    color: var(--text-secondary);
    font-size: 0.85rem;
    margin-top: 0.2rem;
}

/* ── Medical Disclaimer ─────────────────────────────── */
.medical-disclaimer {
    display: flex;
    align-items: flex-start;
    gap: 0.4rem;
    background: var(--warning-bg);
    color: var(--warning-text);
    border: 1px solid var(--warning-border);
    border-radius: var(--r-md);
    padding: 0.6rem 0.9rem;
    font-size: 0.8rem;
    font-weight: 500;
    line-height: 1.5;
    margin-bottom: 1.75rem;
}

/* ── Theme Toggle ───────────────────────────────────── */
.theme-toggle {
    flex-shrink: 0;
    display: flex;
    align-items: center;
    gap: 0.35rem;
    background: var(--bg-card);
    border: 1px solid var(--border);
    border-radius: var(--r-md);
    padding: 0.45rem 0.8rem;
    cursor: pointer;
    color: var(--text-secondary);
    font-family: inherit;
    font-size: 0.78rem;
    font-weight: 500;
    white-space: nowrap;
    transition: border-color var(--t), color var(--t), box-shadow var(--t);
    align-self: flex-start;
}

.theme-toggle:hover {
    border-color: var(--accent);
    color: var(--accent-light);
}

/* ── Dish Cards ─────────────────────────────────────── */
.dishes-container {
    display: flex;
    flex-direction: column;
    gap: 0.875rem;
    margin-bottom: 1.125rem;
}

.dish-card {
    background: var(--bg-card);
    border: 1px solid var(--border);
    border-radius: var(--r-lg);
    padding: 1.125rem;
    transition: border-color var(--t), box-shadow var(--t);
    animation: slideIn 0.22s ease;
}

.dish-card:hover {
    border-color: var(--border-focus);
    box-shadow: 0 0 20px var(--accent-glow);
}

@keyframes slideIn {
    from { opacity:0; transform:translateY(8px); }
    to   { opacity:1; transform:translateY(0); }
}

/* ── Dish Header ────────────────────────────────────── */
/*  Number · ModeToggle · RemoveBtn  — all on one row, single line */
.dish-header {
    display: flex;
    align-items: center;
    gap: 0.625rem;
    margin-bottom: 0.875rem;
}

.dish-number {
    width: 28px;
    height: 28px;
    min-width: 28px;        /* prevent shrink */
    background: var(--gradient-1);
    border-radius: 50%;
    display: flex;
    align-items: center;
    justify-content: center;
    font-weight: 700;
    font-size: 0.78rem;
    color: #fff;
    flex-shrink: 0;
}

/* ── Mode Toggle (pill inside dish header) ──────────── */
.mode-toggle {
    flex: 1;
    display: flex;
    background: var(--bg-input);
    border: 1px solid var(--border);
    border-radius: 9999px;   /* full pill */
    padding: 3px;
    min-width: 0;            /* allow flex shrink */
    overflow: hidden;
}

.mode-btn {
    flex: 1;
    padding: 0.3rem 0.7rem;
    border: none;
    border-radius: 9999px;
    background: transparent;
    color: var(--text-muted);
    font-family: inherit;
    font-size: 0.78rem;
    font-weight: 500;
    cursor: pointer;
    transition: all var(--t);
    white-space: nowrap;
    text-align: center;
}

.mode-btn:hover { color: var(--text-secondary); }

.mode-btn.active {
    background: var(--gradient-1);
    color: #fff;
    box-shadow: 0 2px 8px var(--accent-glow);
}

/* ── Remove dish button ─────────────────────────────── */
.remove-dish-btn {
    flex-shrink: 0;
    background: none;
    border: none;
    color: var(--text-muted);
    cursor: pointer;
    width: 28px;
    height: 28px;
    display: flex;
    align-items: center;
    justify-content: center;
    border-radius: var(--r-sm);
    font-size: 1.15rem;
    line-height: 1;
    transition: color var(--t), background var(--t);
}

.remove-dish-btn:hover {
    color: var(--danger);
    background: var(--danger-bg);
}

/* ── Shared input style ─────────────────────────────── */
.field-input {
    width: 100%;
    height: 38px;
    background: var(--bg-input);
    border: 1px solid var(--border);
    border-radius: var(--r-sm);
    padding: 0 0.75rem;
    color: var(--text-primary);
    font-family: inherit;
    font-size: 0.875rem;
    transition: border-color var(--t);
}

.field-input::placeholder { color: var(--text-muted); }

.field-input:focus {
    outline: none;
    border-color: var(--border-focus);
}

/* Alias for existing JS-generated elements */
.dish-name-input {
    width: 100%;
    height: 38px;
    background: var(--bg-input);
    border: 1px solid var(--border);
    border-radius: var(--r-sm);
    padding: 0 0.75rem;
    color: var(--text-primary);
    font-family: inherit;
    font-size: 0.875rem;
    transition: border-color var(--t);
}

.dish-name-input::placeholder { color: var(--text-muted); }
.dish-name-input:focus { outline:none; border-color: var(--border-focus); }

/* number inputs don't inherit width:100% from browser defaults */
input[type="number"].dish-name-input { width: 100%; }

/* ── Single-item inputs ─────────────────────────────── */
.single-inputs .upload-area { margin-bottom: 0.5rem; }

.single-hint {
    font-size: 0.72rem;
    color: var(--text-muted);
    margin-bottom: 0.625rem;
}

/*
 * Two-column override row:
 *  [Name input — flexible]  [Weight input — fixed 96px]
 * Both columns have IDENTICAL height (38px via field-input).
 * The "g" unit lives INSIDE the weight cell.
 */
.single-overrides {
    display: flex;
    flex-direction: column;
    gap: 0.5rem;
}

/* Weight cell wraps input + "g" in one border box */
.weight-field {
    display: flex;
    align-items: center;
    height: 38px;
    background: var(--bg-input);
    border: 1px solid var(--border);
    border-radius: var(--r-sm);
    padding: 0 0.75rem;
    transition: border-color var(--t);
}

.weight-field:focus-within { border-color: var(--border-focus); }

.weight-input {
    flex: 1;
    min-width: 0;
    background: transparent;
    border: none;
    outline: none;
    color: var(--text-primary);
    font-family: inherit;
    font-size: 0.875rem;
}

.weight-input::placeholder { color: var(--text-muted); }

.weight-unit {
    color: var(--text-muted);
    font-size: 0.82rem;
    font-weight: 500;
    padding-left: 0.3rem;
    flex-shrink: 0;
}

/* ── Composed-dish inputs ───────────────────────────── */
.composed-inputs .dish-name-input { margin-bottom: 0.625rem; }

/* ── Upload Area ────────────────────────────────────── */
.upload-area {
    display: flex;
    gap: 0.5rem;
    align-items: flex-start;
    flex-wrap: wrap;
}

.image-previews {
    display: flex;
    gap: 0.5rem;
    flex-wrap: wrap;
}

.image-preview {
    position: relative;
    width: 72px;
    height: 72px;
    border-radius: var(--r-sm);
    overflow: hidden;
    border: 1px solid var(--border);
    flex-shrink: 0;
}

.image-preview img {
    width: 100%;
    height: 100%;
    object-fit: cover;
    display: block;
}

.image-preview .remove-img {
    position: absolute;
    top: 2px;
    right: 2px;
    width: 18px;
    height: 18px;
    background: rgba(0,0,0,0.65);
    border: none;
    border-radius: 50%;
    color: #fff;
    font-size: 0.6rem;
    cursor: pointer;
    display: flex;
    align-items: center;
    justify-content: center;
    opacity: 0;
    transition: opacity var(--t);
}

.image-preview:hover .remove-img { opacity: 1; }

.upload-btn {
    width: 72px;
    height: 72px;
    border: 2px dashed var(--text-muted);
    border-radius: var(--r-sm);
    background: none;
    color: var(--text-secondary);
    cursor: pointer;
    display: flex;
    flex-direction: column;
    align-items: center;
    justify-content: center;
    gap: 0.15rem;
    font-size: 0.62rem;
    font-family: inherit;
    transition: border-color var(--t), color var(--t), background var(--t);
    flex-shrink: 0;
}

.upload-btn:hover {
    border-color: var(--accent);
    color: var(--accent-light);
    background: var(--accent-glow);
}

.upload-btn .icon { font-size: 1.3rem; }

.upload-btn.disabled {
    opacity: 0.7;
    cursor: not-allowed;
    pointer-events: none;
}

.image-count {
    font-size: 0.7rem;
    color: var(--text-muted);
    margin-top: 0.4rem;
    width: 100%;
}

/* ── Action buttons ─────────────────────────────────── */
.actions {
    display: flex;
    gap: 0.625rem;
    margin-bottom: 1.75rem;
}

.btn {
    height: 42px;
    padding: 0 1.4rem;
    border: none;
    border-radius: var(--r-md);
    font-family: inherit;
    font-size: 0.9rem;
    font-weight: 600;
    cursor: pointer;
    transition: all var(--t);
    white-space: nowrap;
}

.btn-primary {
    flex: 1;
    background: var(--gradient-1);
    color: #fff;
    box-shadow: 0 3px 12px var(--accent-glow);
}

.btn-primary:hover:not(:disabled) {
    transform: translateY(-1px);
    box-shadow: 0 5px 20px var(--accent-glow);
}

.btn-primary:active:not(:disabled) { transform: translateY(0); }

.btn-primary:disabled {
    opacity: 0.4;
    cursor: not-allowed;
    transform: none;
}

.btn-secondary {
    background: var(--bg-card);
    color: var(--text-secondary);
    border: 1px solid var(--border);
}

.btn-secondary:hover {
    border-color: var(--accent);
    color: var(--text-primary);
}

/* ── Loading ────────────────────────────────────────── */
.loading {
    display: none;
    text-align: center;
    padding: 3rem 1rem;
}

.loading.active { display: block; }

.spinner {
    width: 40px;
    height: 40px;
    border: 3px solid var(--border);
    border-top-color: var(--accent);
    border-radius: 50%;
    animation: spin 0.72s linear infinite;
    margin: 0 auto 1rem;
}

@keyframes spin { to { transform: rotate(360deg); } }

.loading p { color: var(--text-secondary); font-size: 0.88rem; }

/* ── Results ────────────────────────────────────────── */
.results { display:none; animation: fadeIn 0.3s ease; }
.results.active { display:block; }

@keyframes fadeIn {
    from { opacity:0; transform:translateY(6px); }
    to   { opacity:1; transform:translateY(0); }
}

.results-header {
    display: flex;
    align-items: center;
    gap: 0.5rem;
    margin-bottom: 1.125rem;
}

.results-header h2 { font-size: 1.15rem; font-weight: 700; }

/* ── Dish Result Cards ──────────────────────────────── */
.dish-result {
    background: var(--bg-card);
    border: 1px solid var(--border);
    border-radius: var(--r-md);
    padding: 0.875rem 1rem;
    margin-bottom: 0.625rem;
    box-shadow: var(--shadow-sm);
}

.dish-result-header {
    display: flex;
    align-items: center;
    flex-wrap: wrap;
    gap: 0.4rem;
    margin-bottom: 0.625rem;
}

.dish-result-name { font-weight: 600; font-size: 0.92rem; }

.dish-result-images {
    font-size: 0.7rem;
    color: var(--text-muted);
    margin-left: auto;
}

.dish-result-thumb {
    width: 38px;
    height: 38px;
    border-radius: var(--r-sm);
    object-fit: cover;
    border: 1px solid var(--border);
    flex-shrink: 0;
}

/* ── Macro Grid ─────────────────────────────────────── */
.macro-grid {
    display: grid;
    grid-template-columns: repeat(4,1fr);
    gap: 0.4rem;
}

.macro-item {
    text-align: center;
    padding: 0.5rem 0.25rem;
    background: var(--bg-input);
    border: 1px solid var(--border);
    border-radius: var(--r-sm);
}

.macro-value { font-weight: 700; font-size: 1rem; }
.macro-label {
    font-size: 0.65rem;
    color: var(--text-muted);
    text-transform: uppercase;
    letter-spacing: 0.06em;
    margin-top: 0.1rem;
}

/* ── Badges ─────────────────────────────────────────── */
.source-tag, .mode-badge {
    font-size: 0.62rem;
    font-weight: 600;
    text-transform: uppercase;
    letter-spacing: 0.05em;
    padding: 0.18rem 0.5rem;
    border-radius: 9999px;
    white-space: nowrap;
}

.source-tag.usda_api {
    background: var(--success-bg);
    color: var(--success);
    border: 1px solid var(--success-border);
}

.source-tag.local_db {
    background: var(--warning-bg);
    color: var(--warning-text);
    border: 1px solid var(--warning-border);
}

.mode-badge.single {
    background: rgba(99,102,241,0.1);
    color: var(--accent-light);
    border: 1px solid rgba(99,102,241,0.25);
}

.mode-badge.composed {
    background: rgba(139,92,246,0.1);
    color: #c084fc;
    border: 1px solid rgba(139,92,246,0.25);
}

.usda-desc { font-size: 0.7rem; color: var(--text-muted); font-style: italic; }

/* ── Classification Info ────────────────────────────── */
.classification-info {
    display: flex;
    align-items: center;
    flex-wrap: wrap;
    gap: 0.4rem;
    padding: 0.4rem 0.6rem;
    margin-bottom: 0.625rem;
    background: rgba(99,102,241,0.06);
    border-radius: var(--r-sm);
    border: 1px solid rgba(99,102,241,0.12);
}

.classification-label { font-size: 0.7rem; color: var(--text-muted); }

.classification-name {
    font-size: 0.8rem;
    font-weight: 600;
    color: var(--accent-light);
    text-transform: capitalize;
}

.classification-confidence {
    font-size: 0.65rem;
    font-weight: 600;
    color: var(--success);
    background: var(--success-bg);
    padding: 0.1rem 0.4rem;
    border-radius: 9999px;
    margin-left: auto;
}

/* ── Totals Card ────────────────────────────────────── */
.totals-card {
    background: var(--bg-card);
    border: 1px solid var(--accent);
    border-radius: var(--r-lg);
    padding: 1.125rem;
    margin: 1.125rem 0;
    box-shadow: 0 0 24px var(--accent-glow);
}

.totals-card h3 {
    font-size: 0.75rem;
    font-weight: 700;
    text-transform: uppercase;
    letter-spacing: 0.12em;
    color: var(--accent-light);
    margin-bottom: 0.875rem;
}

.totals-macro-grid {
    display: grid;
    grid-template-columns: repeat(4,1fr);
    gap: 0.5rem;
    margin-bottom: 0.875rem;
}

.totals-macro-item {
    text-align: center;
    padding: 0.625rem 0.25rem;
    background: rgba(99,102,241,0.07);
    border-radius: var(--r-sm);
    border: 1px solid rgba(99,102,241,0.12);
}

.totals-macro-value { font-weight: 700; font-size: 1.2rem; }

.fpu-row {
    display: grid;
    grid-template-columns: repeat(3,1fr);
    gap: 0.5rem;
    padding-top: 0.875rem;
    border-top: 1px solid var(--border);
}

.fpu-item { text-align: center; }

.fpu-value {
    font-weight: 700;
    font-size: 1.1rem;
    background: var(--gradient-2);
    -webkit-background-clip: text;
    -webkit-text-fill-color: transparent;
    background-clip: text;
}

/* ── Bolus Card ─────────────────────────────────────── */
.bolus-card {
    background: linear-gradient(135deg, rgba(52,211,153,0.06), rgba(6,182,212,0.06));
    border: 1px solid rgba(52,211,153,0.25);
    border-radius: var(--r-lg);
    padding: 1.25rem;
    margin-top: 1.125rem;
}

.bolus-card h3 {
    font-size: 0.95rem;
    font-weight: 700;
    margin-bottom: 1rem;
    display: flex;
    align-items: center;
    gap: 0.5rem;
}

.bolus-split {
    display: grid;
    grid-template-columns: 1fr 1fr;
    gap: 0.75rem;
    margin-bottom: 1rem;
}

.bolus-section {
    padding: 0.875rem;
    border-radius: var(--r-md);
    background: var(--bg-input);
    border: 1px solid var(--border);
}

.bolus-section-title {
    font-size: 0.68rem;
    font-weight: 600;
    text-transform: uppercase;
    letter-spacing: 0.1em;
    color: var(--text-secondary);
    margin-bottom: 0.5rem;
}

.bolus-units { font-size: 1.75rem; font-weight: 700; }
.bolus-units span { font-size: 0.9rem; font-weight: 400; color: var(--text-secondary); }
.bolus-detail { font-size: 0.75rem; color: var(--text-muted); margin-top: 0.2rem; }

.bolus-total {
    display: flex;
    align-items: center;
    justify-content: space-between;
    padding: 0.625rem 0.875rem;
    background: rgba(52,211,153,0.07);
    border: 1px solid rgba(52,211,153,0.2);
    border-radius: var(--r-md);
    margin-bottom: 0.875rem;
}

.bolus-total-label { font-weight: 600; color: var(--success); font-size: 0.875rem; }
.bolus-total-value { font-size: 1.35rem; font-weight: 700; }

.bolus-disclaimer {
    font-size: 0.7rem;
    color: var(--text-muted);
    padding: 0.625rem 0.75rem;
    background: var(--warning-bg);
    border: 1px solid var(--warning-border);
    border-radius: var(--r-sm);
    line-height: 1.55;
}

/* ── Error ──────────────────────────────────────────── */
.error-message {
    display: none;
    padding: 0.75rem 1rem;
    background: var(--danger-bg);
    border: 1px solid var(--danger-border);
    border-radius: var(--r-md);
    color: var(--danger);
    margin-bottom: 1rem;
    font-size: 0.875rem;
}

.error-message.active { display: block; }

/* ── Utility ────────────────────────────────────────── */
.hidden { display: none !important; }

/* ── New Analysis ───────────────────────────────────── */
.new-analysis-btn {
    width: 100%;
    margin-top: 1.75rem;
    animation: fadeIn 0.3s ease;
}

/* ═══════════════════════════════════════════════════════
   RESPONSIVE
   ═══════════════════════════════════════════════════════ */

/* Tablet ≤ 680px */
@media (max-width: 680px) {
    .container { padding: 1.25rem 1rem 3rem; }

    .page-header { align-items: flex-start; }

    /* Hide theme label text, keep icon only */
    .theme-toggle .theme-label { display: none; }
    .theme-toggle { padding: 0.45rem 0.6rem; }

    .macro-grid          { grid-template-columns: repeat(2,1fr); }
    .totals-macro-grid   { grid-template-columns: repeat(2,1fr); }
}

/* Mobile ≤ 500px */
@media (max-width: 500px) {
    .container { padding: 1rem 0.75rem 3rem; }

    .title-row h1 { font-size: 1.3rem; }
    .medical-disclaimer { font-size: 0.75rem; }

    /* Stack action buttons full-width, equal height */
    .actions { flex-direction: column; }
    .actions .btn { width: 100%; flex: none; }

    /* Single-override: stack name above weight */
    .single-overrides {
        grid-template-columns: 1fr;
    }

    /* Weight field full-width on mobile */
    .weight-field { width: 100%; }

    .fpu-row { grid-template-columns: 1fr; gap: 0.4rem; }

    .bolus-split { grid-template-columns: 1fr; }
    .bolus-units { font-size: 1.4rem; }

    .totals-macro-value { font-size: 1rem; }
}
