# ──────────────────────────────────────────────────────────────
# Configuration for Food Macro Estimation Model
# ──────────────────────────────────────────────────────────────

# ── Backbone ──────────────────────────────────────────────────
backbone: efficientnet_b0        # timm model name
pretrained: true
freeze_backbone: true            # Phase 1: train head only
unfreeze_top_n: 3                # Phase 2: unfreeze last N blocks

# ── Image ─────────────────────────────────────────────────────
image_size: 224
image_mean: [0.485, 0.456, 0.406]   # ImageNet defaults
image_std:  [0.229, 0.224, 0.225]

# ── Data ──────────────────────────────────────────────────────
data_csv: data/nutrition5k/processed.csv
data_root: data/nutrition5k        # prepended to image_path
batch_size: 32
num_workers: 4
val_split: 0.15
test_split: 0.10

# ── Target normalisation (z-score) ────────────────────────────
# Will be recomputed from data at training start if set to null
target_mean: null    # [weight, carbs, protein, fat]
target_std:  null

# ── Training ──────────────────────────────────────────────────
epochs_frozen: 10       # epochs with frozen backbone
epochs_finetune: 20     # epochs with unfrozen top-N
lr_head: 1.0e-3
lr_backbone: 1.0e-4
weight_decay: 1.0e-4
optimizer: adamw         # adam | adamw

# ── Loss weights (λ) ─────────────────────────────────────────
loss_type: smooth_l1     # smooth_l1 | mse
lambda_weight: 1.0
lambda_carbs:  2.0       # carbs are highest priority
lambda_protein: 1.0
lambda_fat: 1.0

# ── Effective carbs formula ───────────────────────────────────
# effective_carbs = carbs + alpha * protein + beta * fat
effective_carbs_alpha: 0.5
effective_carbs_beta:  0.1

# ── Early stopping ────────────────────────────────────────────
early_stopping_patience: 7
early_stopping_metric: val_carbs_mae   # monitor carb MAE

# ── Checkpoints ───────────────────────────────────────────────
checkpoint_dir: models
save_best_only: true

# ── Inference ─────────────────────────────────────────────────
multi_image_strategy: mean   # mean | max — how to aggregate
